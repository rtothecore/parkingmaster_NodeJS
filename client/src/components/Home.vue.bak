<template>
<div style="position:absolute height:900px;">    
    <!-- <div id="calendar" v-bind:style="{ height: calendarHeight, width: calendarWidth, float: 'left'}"> -->
      <!-- dummy --> <div style="height:20px"/>

      <div style="width:1600px; margin:0 auto;">
        
        <b-row>
          <b-col md="12">
            <b-card header="날씨 정보" header-tag="header">
              <h3 slot="header" class="mb-0"><strong>날씨 정보</strong></h3>
              <b-row>
                <b-col sm="12" lg="6">
                  <div style="width:1560px; margin:0 auto;">
                    
                    <b-row>
                      <b-col sm="6" lg="2">
                        <b-card no-body>
                          <b-card-body class="pb-0">
                            
                            <!-- <v-container fluid grid-list-lg> -->
                              <v-layout>
                                <div>                    
                                <div class="caption">                                  
                                  <v-text-field                                    
                                    v-model="parkingName"
                                    label="주소"                                    
                                    prepend-icon="event"
                                    readonly                                    
                                  ></v-text-field>
                                </div>
                                </div>
                              </v-layout>
                              
                            <!-- </v-container> -->

                          </b-card-body>
                          
                        </b-card>
                      </b-col>

                      <b-col sm="6" lg="2">
                        <b-card no-body>
                          <b-card-body class="pb-0">
                            
                            <!-- <v-container fluid grid-list-lg> -->
                              

                              <v-layout row>
                                <v-flex xs7>
                                  <div>
                                    <div class="subheading">&nbsp;&nbsp;&nbsp;&nbsp;오늘</div>
                                    <div class="title">&nbsp;&nbsp;&nbsp;{{ todayT1h }}</div>
                                  </div>
                                </v-flex>
                                <v-flex xs5>
                                  <v-img
                                    :src="todaySkyImg"
                                    height="65px"
                                    contain
                                  ></v-img>
                                </v-flex>
                              </v-layout>

                              <v-layout>
                                <div>
                                <div class="caption">{{ todayPm10 }}</div>   
                                <div class="caption">&nbsp;</div> 
                                
                                </div>
                              </v-layout>
                            <!-- </v-container> -->

                          </b-card-body>
                          
                        </b-card>
                      </b-col>

                      <b-col sm="6" lg="2">
                        <b-card no-body>
                          <b-card-body class="pb-0">
                            
                            <!-- <v-container fluid grid-list-lg> -->
                              <v-layout row>
                                <v-flex xs7>
                                  <div>
                                    <div class="subheading">&nbsp;&nbsp;&nbsp;&nbsp;내일 오전</div>
                                    <div class="title">&nbsp;&nbsp;&nbsp;{{ tomorrowAmT1h }}</div>
                                  </div>
                                </v-flex>
                                <v-flex xs5>
                                  <v-img
                                    :src="tomAmSkyImg"
                                    height="100px"
                                    contain
                                  ></v-img>
                                </v-flex>
                              </v-layout>
                              
                            <!-- </v-container> -->
                            
                          </b-card-body>
                          
                        </b-card>
                      </b-col>

                      <b-col sm="6" lg="2">
                        <b-card no-body>
                          <b-card-body class="pb-0">
                            
                            <!-- <v-container fluid grid-list-lg> -->
                              <v-layout row>
                                <v-flex xs7>
                                  <div>
                                    <div class="subheading">&nbsp;&nbsp;&nbsp;&nbsp;내일 오후</div>
                                    <div class="title">&nbsp;&nbsp;&nbsp;{{ tomorrowPmT1h }}</div>
                                  </div>
                                </v-flex>
                                <v-flex xs5>
                                  <v-img
                                    :src="tomPmSkyImg"
                                    height="100px"
                                    contain
                                  ></v-img>
                                </v-flex>
                              </v-layout>
                              
                            <!-- </v-container> -->
                            
                          </b-card-body>
                          
                        </b-card>
                      </b-col>

                      <b-col sm="6" lg="2">
                        <b-card no-body>
                          <b-card-body class="pb-0">
                            
                            <!-- <v-container fluid grid-list-lg> -->
                              <v-layout row>
                                <v-flex xs7>
                                  <div>
                                    <div class="subheading">&nbsp;&nbsp;&nbsp;&nbsp;모레 오전</div>
                                    <div class="title">&nbsp;&nbsp;&nbsp;{{ afterTomorrowAmT1h }}</div>
                                  </div>
                                </v-flex>
                                <v-flex xs5>
                                  <v-img
                                    :src="afTomAmSkyImg"
                                    height="100px"
                                    contain
                                  ></v-img>
                                </v-flex>
                              </v-layout>

                            <!-- </v-container> -->
                            
                          </b-card-body>
                          
                        </b-card>
                      </b-col>

                      <b-col sm="6" lg="2">
                        <b-card no-body>
                          <b-card-body class="pb-0">
                            
                            <!-- <v-container fluid grid-list-lg> -->
                              <v-layout row>
                                <v-flex xs7>
                                  <div>
                                    <div class="subheading">&nbsp;&nbsp;&nbsp;&nbsp;모레 오후</div>
                                    <div class="title">&nbsp;&nbsp;&nbsp;{{ afterTomorrowPmT1h }}</div>
                                  </div>
                                </v-flex>
                                <v-flex xs5>
                                  <v-img
                                    :src="afTomPmSkyImg"
                                    height="100px"
                                    contain
                                  ></v-img>
                                </v-flex>
                              </v-layout>

                            <!-- </v-container> -->
                            
                          </b-card-body>
                          
                        </b-card>
                      </b-col>

                    </b-row>

                  </div>
                </b-col>              
              </b-row>              
            </b-card>
          </b-col>
        </b-row>
        
      </div>

      <!-- 주차장 현재현황 -->
      <div style="width:1600px; margin:0 auto;">
        <b-row>
          <b-col md="12">
            <b-card header="주차장 현재현황" header-tag="header">
              <h3 slot="header" class="mb-0"><strong>주차장 현재현황</strong><h4>주차효율:25%, 회전율:0.6대 (모든 데이터는 과거 1달을 기준으로 계산하였습니다)</h4></h3>
              <b-row>
                            
                <b-col sm="12" lg="3">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer1" style="height: 300px; width: 100%;" />
                            <!-- <div id="total" style="position:absolute;left:5px;top:-40px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">70%</div> -->
                            <div id="total" style="position:absolute;left:5px;top:-15px;height:100%;width:100%;line-height:360px;text-align:center;color:black;font-size:24px;">70/100대</div>
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>              
              <!--
              <div id="chartContainer1" style="height: 300px; width: 100%;" />
              <div id="total" style="position:absolute;left:5px;top:20px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">70%</div>
              <div id="total" style="position:absolute;left:5px;top:45px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:22px;">70/100</div>
              -->

                <!-- 주차 효율 -->
                <!--
                <b-col sm="12" lg="4">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer1" style="height: 300px; width: 100%;" />
                            <div id="total" style="position:absolute;left:5px;top:-40px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">25%</div>
                            <div id="total" style="position:absolute;left:5px;top:-10px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:22px;">주차 효율</div>
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>
                -->
                <!-- 주차 효율 -->

                <!-- 주차 회전율 -->
                <!--
                <b-col sm="12" lg="4">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer1" style="height: 300px; width: 100%;" />
                            <div id="total" style="position:absolute;left:5px;top:-40px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">0.6대</div>
                            <div id="total" style="position:absolute;left:5px;top:-10px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:22px;">주차 회전율</div>
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>
                -->
                <!-- 주차 회전율 -->

                <!-- 주차 이용 시간 -->
                <b-col sm="12" lg="3">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                                                
                            <div id="total" style="position:absolute;left:5px;top:-140px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:22px;">주차이용시간</div>
                            <div id="total" style="position:absolute;left:5px;top:-110px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">600/720시간</div>                            
                            <div id="chartContainer2" style="height: 300px; width: 100%;" />
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>
                <!-- 주차 이용 시간 -->

                <!-- 가장 많은 주차 이용 시간 -->
                <b-col sm="12" lg="3">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                                                
                            <div id="total" style="position:absolute;left:5px;top:-140px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:22px;">가장 많은 주차이용시간</div>
                            <div id="total" style="position:absolute;left:5px;top:-110px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">20-30분</div>                            
                            <div id="chartContainer3" style="height: 300px; width: 100%;" />
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>
                <!-- 가장 많은 주차 이용 시간 -->

                <!-- 가장 붐비는 요일 -->
                <b-col sm="12" lg="3">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                                                
                            <div id="total" style="position:absolute;left:5px;top:-140px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:22px;">가장 붐비는 요일</div>
                            <div id="total" style="position:absolute;left:5px;top:-110px;height:100%;width:100%;line-height:360px;text-align:center;color:grey;font-size:30px;">목요일</div>                            
                            <div id="chartContainer4" style="height: 300px; width: 100%;" />
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>
                <!-- 가장 붐비는 요일 -->

              </b-row>              
            </b-card>
          </b-col>
        </b-row>
      </div>
      <!-- 주차장 현재현황 -->  

      <!-- 주차장 입,출차 예측 -->
      <div style="width:1600px; margin:0 auto;">
        <b-row>
          <b-col md="12">
            <b-card header="주차장 입,출차 예측" header-tag="header">
              <h3 slot="header" class="mb-0"><strong>주차장 입,출차 예측</strong></h3>
              <b-row>
              
                <b-col sm="6" lg="4">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer5" style="height: 160px; width: 100%;" />                            
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>

                <b-col sm="6" lg="4">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer6" style="height: 160px; width: 100%;" />                            
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>

                <b-col sm="6" lg="4">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer7" style="height: 160px; width: 100%;" />                            
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>

                <b-col sm="6" lg="6">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>                    
                            <div id="chartContainer8" style="height: 160px; width: 100%;" />                            
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>

                <b-col sm="6" lg="6">
                  <b-card no-body>
                    <b-card-body class="pb-0">  
                        <v-layout>
                          <div>  
                            <!--
                            <v-layout row ma-2 justify-center>
                              <v-flex xs6 sm6 md6 order-md1 order-xs1>
                                <v-menu
                                  :close-on-content-click="false"
                                  v-model="menu1"
                                  :nudge-right="40"
                                  lazy
                                  transition="scale-transition"
                                  offset-y
                                  full-width
                                  max-width="290px"
                                  min-width="290px"
                                >
                                  <v-text-field
                                    slot="activator"
                                    v-model="computedDateFormatted"
                                    label="시작년월"
                                    persistent-hint
                                    prepend-icon="event"
                                    readonly                                    
                                    data-vv-name="startDate"
                                  ></v-text-field>
                                  <v-date-picker v-model="sDate" no-title @input="menu1 = false" locale='euc-kr'></v-date-picker>
                                </v-menu>
                              </v-flex>
                              <v-flex xs6 md6 order-md2 order-xs2>
                                <v-btn                                
                                  color="primary"
                                  class="white--text"
                                  @click.native="searchJournals"
                                >
                                  예측
                                </v-btn>
                              </v-flex>                  
                            </v-layout>
                            -->
                            <div id="chartContainer9" style="height: 160px; width: 100%;" />                            
                          </div>
                        </v-layout>                      
                    </b-card-body>
                  </b-card>
                </b-col>

              </b-row>              
            </b-card>
          </b-col>
        </b-row>
      </div>
      <!-- 주차장 입,출차 예측 -->           
</div>
</template>

<script>
    // import {bus} from '../main'
    import WeatherService from '@/services/WeatherService'
    import proj4 from 'proj4'
    import Moment from 'moment'
    import { extendMoment } from 'moment-range'
    const moment = extendMoment(Moment)
    const CanvasJS = require('../../canvasjs.min.js')
    export default {
  data () {
        return {
          chart7Options: {
            animationEnabled: true,
            width: 700,
            theme: 'light2',
            title: {
              text: '특정일자의 입,출차 예측'
            },
            axisX: {
              title: '시간',
              interval: 2,
              intervalType: 'hour',
              // valueFormatString: 'DD MMM',
              valueFormatString: 'hh TT',
              crosshair: {
                enabled: true,
                snapToDataPoint: true
              }
            },
            axisY: {
              title: '입차대수',
              crosshair: {
                enabled: true
              }
            },
            toolTip: {
              shared: true
            },
            legend: {
              cursor: 'pointer',
              verticalAlign: 'bottom',
              horizontalAlign: 'left',
              dockInsidePlotArea: true,
              itemclick: this.toogleDataSeries
            },
            data: [
              {
                type: 'line',
                showInLegend: true,
                name: '입차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'Orange',
                dataPoints: [
                  { x: new Date(2019, 1, 14, 0, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 1, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 2, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 3, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 4, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 5, 0), y: 67 },
                  { x: new Date(2019, 1, 14, 6, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 7, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 8, 0), y: 62 },
                  { x: new Date(2019, 1, 14, 9, 0), y: 66 },
                  { x: new Date(2019, 1, 14, 10, 0), y: 72 },
                  { x: new Date(2019, 1, 14, 11, 0), y: 68 },
                  { x: new Date(2019, 1, 14, 12, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 13, 0), y: 59 },
                  { x: new Date(2019, 1, 14, 14, 0), y: 48 },
                  { x: new Date(2019, 1, 14, 15, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 16, 0), y: 39 },
                  { x: new Date(2019, 1, 14, 17, 0), y: 80 },
                  { x: new Date(2019, 1, 14, 18, 0), y: 82 },
                  { x: new Date(2019, 1, 14, 19, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 20, 0), y: 76 },
                  { x: new Date(2019, 1, 14, 21, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 22, 0), y: 49 },
                  { x: new Date(2019, 1, 14, 23, 0), y: 25 }
                ]
              },
              {
                type: 'line',
                showInLegend: true,
                name: '출차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'OrangeRed',
                dataPoints: [
                  { x: new Date(2019, 1, 14, 0, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 1, 0), y: 35 },
                  { x: new Date(2019, 1, 14, 2, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 3, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 4, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 5, 0), y: 57 },
                  { x: new Date(2019, 1, 14, 6, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 7, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 8, 0), y: 52 },
                  { x: new Date(2019, 1, 14, 9, 0), y: 56 },
                  { x: new Date(2019, 1, 14, 10, 0), y: 62 },
                  { x: new Date(2019, 1, 14, 11, 0), y: 58 },
                  { x: new Date(2019, 1, 14, 12, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 13, 0), y: 49 },
                  { x: new Date(2019, 1, 14, 14, 0), y: 38 },
                  { x: new Date(2019, 1, 14, 15, 0), y: 35 },
                  { x: new Date(2019, 1, 14, 16, 0), y: 29 },
                  { x: new Date(2019, 1, 14, 17, 0), y: 70 },
                  { x: new Date(2019, 1, 14, 18, 0), y: 72 },
                  { x: new Date(2019, 1, 14, 19, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 20, 0), y: 66 },
                  { x: new Date(2019, 1, 14, 21, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 22, 0), y: 39 },
                  { x: new Date(2019, 1, 14, 23, 0), y: 15 }
                ]
              }
            ]
          },
          chart6Options: {
            animationEnabled: true,
            width: 700,
            theme: 'light2',
            title: {
              text: '앞으로 일주일의 입,출차 예측'
            },
            axisX: {
              title: '날짜',
              interval: 1,
              intervalType: 'day',
              valueFormatString: 'DD MMM',
              crosshair: {
                enabled: true,
                snapToDataPoint: true
              }
            },
            axisY: {
              title: '입차대수',
              crosshair: {
                enabled: true
              }
            },
            toolTip: {
              shared: true
            },
            legend: {
              cursor: 'pointer',
              verticalAlign: 'bottom',
              horizontalAlign: 'left',
              dockInsidePlotArea: true,
              itemclick: this.toogleDataSeries
            },
            data: [
              {
                type: 'line',
                showInLegend: true,
                name: '입차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'Orange',
                dataPoints: [
                  { x: new Date(2019, 1, 14), y: 75 },
                  { x: new Date(2019, 1, 15), y: 45 },
                  { x: new Date(2019, 1, 16), y: 55 },
                  { x: new Date(2019, 1, 17), y: 65 },
                  { x: new Date(2019, 1, 18), y: 75 },
                  { x: new Date(2019, 1, 19), y: 67 },
                  { x: new Date(2019, 1, 20), y: 75 }
                ]
              },
              {
                type: 'line',
                showInLegend: true,
                name: '출차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'OrangeRed',
                dataPoints: [
                  { x: new Date(2019, 1, 14), y: 65 },
                  { x: new Date(2019, 1, 15), y: 35 },
                  { x: new Date(2019, 1, 16), y: 45 },
                  { x: new Date(2019, 1, 17), y: 55 },
                  { x: new Date(2019, 1, 18), y: 65 },
                  { x: new Date(2019, 1, 19), y: 57 },
                  { x: new Date(2019, 1, 20), y: 65 }
                ]
              }
            ]
          },
          chart5Options: {
            width: 340,
            theme: 'light2',
            animationEnabled: true,
            title: {
              text: '600/720시간'
            },
            subtitles: [{
              text: '주차 이용 시간',
              fontSize: 24
            }],
            data: [{
              type: 'pie',
              showInLegend: true,
              indexLabelFontSize: 14,
              radius: 80,
              // indexLabel: '{label} - {y}',
              indexLabel: '{y}',
              // yValueFormatString: '###0.0\'%\'',
              yValueFormatString: '###0.0시간',
              click: this.explodePie,
              dataPoints: [
                { y: 600, label: '주차이용시간', name: '주차이용시간', exploded: true, color: 'Orange' },
                { y: 120, label: '주차공백시간', name: '주차공백시간', color: 'OrangeRed' }
              ]
            }]
          },
          chart8Options: {
            width: 340,
            theme: 'light2',
            animationEnabled: true,
            title: {
              text: '1 - 2시간'
            },
            subtitles: [{
              text: '가장 많은 주차이용시간',
              fontSize: 24
            }],
            data: [{
              type: 'pie',
              showInLegend: true,
              indexLabelFontSize: 14,
              radius: 80,
              indexLabel: '{label}',
              // indexLabel: '{label} - {y}',
              yValueFormatString: '###0.0\'%\'',
              // yValueFormatString: '###0.0시간',
              click: this.explodePie,
              dataPoints: [
                { y: 10, label: '30분이내', name: '30분이내', color: 'Orchid' },
                { y: 20, label: '30-1시간', name: '30-1시간', color: 'PaleGoldenRod' },
                { y: 40, label: '1-2시간', name: '1-2시간', exploded: true, color: 'Orange' },
                { y: 30, label: '2시간초과', name: '2시간초과', color: 'OrangeRed' }
              ]
            }]
          },
          chart9Options: {
            width: 340,
            theme: 'light2',
            animationEnabled: true,
            title: {
              text: '목요일'
            },
            subtitles: [{
              text: '가장 붐비는 요일',
              fontSize: 24
            }],
            data: [{
              type: 'pie',
              indexLabelFontSize: 14,
              radius: 80,
              indexLabel: '{label}',
              // indexLabel: '{label} - {y}',
              yValueFormatString: '###0.0\'%\'',
              // yValueFormatString: '###0.0시간',
              click: this.explodePie,
              dataPoints: [
                { y: 20, label: '일', color: 'OrangeRed' },
                { y: 10, label: '월', color: 'Orchid' },
                { y: 15, label: '화', color: 'PaleGoldenRod' },
                { y: 10, label: '수', color: 'PaleGreen' },
                { y: 25, label: '목', exploded: true, color: 'Orange' },
                { y: 10, label: '금', color: 'PaleTurquoise' },
                { y: 10, label: '토', color: 'PaleVioletRed' }
              ]
            }]
          },
          chart4Options: {
            animationEnabled: true,
            width: 440,
            theme: 'light2',
            title: {
              text: '모레 입,출차 예측'
            },
            axisX: {
              title: '시간',
              interval: 2,
              intervalType: 'hour',
              // valueFormatString: 'DD MMM',
              valueFormatString: 'hh TT',
              crosshair: {
                enabled: true,
                snapToDataPoint: true
              }
            },
            axisY: {
              title: '입차대수',
              crosshair: {
                enabled: true
              }
            },
            toolTip: {
              shared: true
            },
            legend: {
              cursor: 'pointer',
              verticalAlign: 'bottom',
              horizontalAlign: 'left',
              dockInsidePlotArea: true,
              itemclick: this.toogleDataSeries
            },
            data: [
              {
                type: 'line',
                showInLegend: true,
                name: '입차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'Orange',
                dataPoints: [
                  { x: new Date(2019, 1, 14, 0, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 1, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 2, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 3, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 4, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 5, 0), y: 67 },
                  { x: new Date(2019, 1, 14, 6, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 7, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 8, 0), y: 62 },
                  { x: new Date(2019, 1, 14, 9, 0), y: 66 },
                  { x: new Date(2019, 1, 14, 10, 0), y: 72 },
                  { x: new Date(2019, 1, 14, 11, 0), y: 68 },
                  { x: new Date(2019, 1, 14, 12, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 13, 0), y: 59 },
                  { x: new Date(2019, 1, 14, 14, 0), y: 48 },
                  { x: new Date(2019, 1, 14, 15, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 16, 0), y: 39 },
                  { x: new Date(2019, 1, 14, 17, 0), y: 80 },
                  { x: new Date(2019, 1, 14, 18, 0), y: 82 },
                  { x: new Date(2019, 1, 14, 19, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 20, 0), y: 76 },
                  { x: new Date(2019, 1, 14, 21, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 22, 0), y: 49 },
                  { x: new Date(2019, 1, 14, 23, 0), y: 25 }
                ]
              },
              {
                type: 'line',
                showInLegend: true,
                name: '출차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'OrangeRed',
                dataPoints: [
                  { x: new Date(2019, 1, 14, 0, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 1, 0), y: 35 },
                  { x: new Date(2019, 1, 14, 2, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 3, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 4, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 5, 0), y: 57 },
                  { x: new Date(2019, 1, 14, 6, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 7, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 8, 0), y: 52 },
                  { x: new Date(2019, 1, 14, 9, 0), y: 56 },
                  { x: new Date(2019, 1, 14, 10, 0), y: 62 },
                  { x: new Date(2019, 1, 14, 11, 0), y: 58 },
                  { x: new Date(2019, 1, 14, 12, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 13, 0), y: 49 },
                  { x: new Date(2019, 1, 14, 14, 0), y: 38 },
                  { x: new Date(2019, 1, 14, 15, 0), y: 35 },
                  { x: new Date(2019, 1, 14, 16, 0), y: 29 },
                  { x: new Date(2019, 1, 14, 17, 0), y: 70 },
                  { x: new Date(2019, 1, 14, 18, 0), y: 72 },
                  { x: new Date(2019, 1, 14, 19, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 20, 0), y: 66 },
                  { x: new Date(2019, 1, 14, 21, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 22, 0), y: 39 },
                  { x: new Date(2019, 1, 14, 23, 0), y: 15 }
                ]
              }
            ]
          },
          chart3Options: {
            animationEnabled: true,
            width: 440,
            theme: 'light2',
            title: {
              text: '내일 입,출차 예측'
            },
            axisX: {
              title: '시간',
              interval: 2,
              intervalType: 'hour',
              // valueFormatString: 'DD MMM',
              valueFormatString: 'hh TT',
              crosshair: {
                enabled: true,
                snapToDataPoint: true
              }
            },
            axisY: {
              title: '입차대수',
              crosshair: {
                enabled: true
              }
            },
            toolTip: {
              shared: true
            },
            legend: {
              cursor: 'pointer',
              verticalAlign: 'bottom',
              horizontalAlign: 'left',
              dockInsidePlotArea: true,
              itemclick: this.toogleDataSeries
            },
            data: [
              {
                type: 'line',
                showInLegend: true,
                name: '입차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                color: 'Orange',
                dataPoints: [
                  { x: new Date(2019, 1, 14, 0, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 1, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 2, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 3, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 4, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 5, 0), y: 67 },
                  { x: new Date(2019, 1, 14, 6, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 7, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 8, 0), y: 62 },
                  { x: new Date(2019, 1, 14, 9, 0), y: 66 },
                  { x: new Date(2019, 1, 14, 10, 0), y: 72 },
                  { x: new Date(2019, 1, 14, 11, 0), y: 68 },
                  { x: new Date(2019, 1, 14, 12, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 13, 0), y: 59 },
                  { x: new Date(2019, 1, 14, 14, 0), y: 48 },
                  { x: new Date(2019, 1, 14, 15, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 16, 0), y: 39 },
                  { x: new Date(2019, 1, 14, 17, 0), y: 80 },
                  { x: new Date(2019, 1, 14, 18, 0), y: 82 },
                  { x: new Date(2019, 1, 14, 19, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 20, 0), y: 76 },
                  { x: new Date(2019, 1, 14, 21, 0), y: 75 },
                  { x: new Date(2019, 1, 14, 22, 0), y: 49 },
                  { x: new Date(2019, 1, 14, 23, 0), y: 25 }
                ]
              },
              {
                type: 'line',
                showInLegend: true,
                name: '출차대수',
                markerType: 'square',
                xValueFormatString: 'DD MMM, YYYY',
                // color: '#F08080',
                color: 'OrangeRed',
                dataPoints: [
                  { x: new Date(2019, 1, 14, 0, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 1, 0), y: 35 },
                  { x: new Date(2019, 1, 14, 2, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 3, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 4, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 5, 0), y: 57 },
                  { x: new Date(2019, 1, 14, 6, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 7, 0), y: 45 },
                  { x: new Date(2019, 1, 14, 8, 0), y: 52 },
                  { x: new Date(2019, 1, 14, 9, 0), y: 56 },
                  { x: new Date(2019, 1, 14, 10, 0), y: 62 },
                  { x: new Date(2019, 1, 14, 11, 0), y: 58 },
                  { x: new Date(2019, 1, 14, 12, 0), y: 55 },
                  { x: new Date(2019, 1, 14, 13, 0), y: 49 },
                  { x: new Date(2019, 1, 14, 14, 0), y: 38 },
                  { x: new Date(2019, 1, 14, 15, 0), y: 35 },
                  { x: new Date(2019, 1, 14, 16, 0), y: 29 },
                  { x: new Date(2019, 1, 14, 17, 0), y: 70 },
                  { x: new Date(2019, 1, 14, 18, 0), y: 72 },
                  { x: new Date(2019, 1, 14, 19, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 20, 0), y: 66 },
                  { x: new Date(2019, 1, 14, 21, 0), y: 65 },
                  { x: new Date(2019, 1, 14, 22, 0), y: 39 },
                  { x: new Date(2019, 1, 14, 23, 0), y: 15 }
                ]
              }
            ]
          },
          chart2Options: {
            animationEnabled: true,
            width: 440,
            theme: 'light2',
            title: {
              text: '1시간 후 입,출차 예측'
            },
            axisX: {
              title: '시간',
              interval: 1,
              intervalType: 'hour',
              // valueFormatString: 'DD MMM',
              valueFormatString: 'hh TT',
              crosshair: {
                enabled: true,
                snapToDataPoint: true
              }
            },
            axisY: {
              title: '입차대수',
              crosshair: {
                enabled: true
              }
            },
            toolTip: {
              shared: true
            },
            legend: {
              cursor: 'pointer',
              verticalAlign: 'bottom',
              horizontalAlign: 'left',
              dockInsidePlotArea: true,
              itemclick: this.toogleDataSeries
            },
            data: [{
              type: 'column',
              showInLegend: true,
              name: '입차대수',
              markerType: 'square',
              xValueFormatString: 'DD MMM, YYYY',
              color: '#F0F080',
              dataPoints: [
                { x: new Date(2019, 1, 13, 14, 0), y: 35, color: 'Orange' }
              ]
            },
            {
              type: 'column',
              showInLegend: true,
              name: '출차대수',
              markerType: 'square',
              xValueFormatString: 'DD MMM, YYYY',
              color: '#F08080',
              dataPoints: [
                { x: new Date(2019, 1, 13, 14, 0), y: 45, color: 'OrangeRed' }
              ]
            }
            ]
          },
          chart1Options: {
            width: 340,
            // colorSet: 'greenShades',
            animationEnabled: true,
            title: {
              text: '현재 주차대수'
              // horizontalAlign: 'left'
            },
            data: [{
              type: 'doughnut',
              showInLegend: true,
              startAngle: 60,
              // innerRadius: 60,
              indexLabelFontSize: 14,
              indexLabel: '#percent%',
              // indexLabel: '{label} - #percent%',              
              toolTipContent: '<b>{label}:</b> {y} (#percent%)',
              dataPoints: [
                { y: 70, label: '주차대수', name: '주차대수', exploded: true, color: 'Orange' },
                { y: 30, label: '가용대수', name: '가용대수', color: "OrangeRed"}
              ]
            }]
          },
          sDate: null,
          menu1: false,
          chart1: '',
          chart2: '',
          chart3: '',
          chart4: '',
          chart5: '',
          chart6: '',
          chart7: '',
          chart8: '',
          chart9: '',
          parkingName: '제주벤처마루',
          selectAddress: '제주시 중앙로 217',
          weatherLoc: '',
          todayPm10: '',
          afTomAmSkyImg: '',
          afTomPmSkyImg: '',
          tomPmSkyImg: '',
          tomAmSkyImg: '',
          todaySkyImg: '',
          afterTomorrowAmT1h: '',
          afterTomorrowPmT1h: '',
          tomorrowPmT1h: '',
          tomorrowAmT1h: '',
          todayT1h: '',
          userId: 'hyeok'
        }
  },
  mounted () {
        CanvasJS.addColorSet('greenShades',
          [
            '#3CB371',
            '#B3E5E5'
          ]
        )

        this.chart1 = new CanvasJS.Chart('chartContainer1', this.chart1Options)
        this.chart1.render()

        this.chart2 = new CanvasJS.Chart('chartContainer2', this.chart5Options)
        this.chart2.render()

        this.chart3 = new CanvasJS.Chart('chartContainer3', this.chart8Options)
        this.chart3.render()

        this.chart4 = new CanvasJS.Chart('chartContainer4', this.chart9Options)
        this.chart4.render()

        this.chart5 = new CanvasJS.Chart('chartContainer5', this.chart2Options)
        this.chart5.render()

        this.chart6 = new CanvasJS.Chart('chartContainer6', this.chart3Options)
        this.chart6.render()

        this.chart7 = new CanvasJS.Chart('chartContainer7', this.chart4Options)
        this.chart7.render()

        this.chart8 = new CanvasJS.Chart('chartContainer8', this.chart6Options)
        this.chart8.render()

        this.chart9 = new CanvasJS.Chart('chartContainer9', this.chart7Options)
        this.chart9.render()
  },
  beforeCreate: function () {
    /*
        if (!this.$session.exists()) {
          this.$router.push('/login')
        } else {
        }
    */
  },
  created () {
        // this.userId = this.$session.get('userId')
        this.userId = 'hyeok'
        this.getLocation()
        this.sDate = moment().format('YYYY-MM-DD').substr(0, 10)
  },
  computed: {
        computedDateFormatted () {
          this.sDate = this.sDate.substr(0, 10)
          console.log(this.sDate)
          return this.sDate
        }
  },
  methods: {
        async fetchTodayWeather (nx, ny) {
          const response = await WeatherService.fetchTodayWeather({
            nx: nx,
            ny: ny
          })
          // console.log(response.data)
          for (var i = 0; i < response.data.item.length; i++) {
            // var sky = 'SKY'
            var t1h = 'T1H'
            var reh = 'REH'
            var pty = 'PTY'
            if (pty === response.data.item[i].category) {
              switch (response.data.item[i].obsrValue) {
                case 0 :  // 없음
                  this.todaySkyImg = require('../assets/sun.png')
                  break
                case 1 :  // 비
                  this.todaySkyImg = require('../assets/rain.png')
                  break
                case 2 :  // 비,눈
                  this.todaySkyImg = require('../assets/rain.png')
                  break
                case 3 :  // 눈
                  this.todaySkyImg = require('../assets/snow.png')
                  break
                default :
                  break
              }
            } else if (t1h === response.data.item[i].category) {
              this.todayT1h = response.data.item[i].obsrValue + '℃'
            } else if (reh === response.data.item[i].category) {
              this.todayREH = response.data.item[i].obsrValue + '%'
            }
          }
        },
        async fetchWeatherForecast (nx, ny) {
          const response = await WeatherService.fetchWeatherForecast({
            nx: nx,
            ny: ny
          })
          // TOMORROW START
          var todayDate = new Date()
          todayDate.setDate(todayDate.getDate() + 1)
          var todayYYYYMMDD = this.leadingZeros(todayDate.getFullYear(), 4) +
                              this.leadingZeros(todayDate.getMonth() + 1, 2) +
                              this.leadingZeros(todayDate.getDate(), 2) + ''
          this.tt1Date = todayYYYYMMDD.substring(4, 6) + '/' + todayYYYYMMDD.substring(6, 8)
          var onlyFcstDate = []
          for (var i = 0; i < response.data.item.length; i++) {
            if (todayYYYYMMDD === response.data.item[i].fcstDate + '') {
              onlyFcstDate.push(response.data.item[i])
            }
          }

          var onlyFcstTime = []
          var fcstTime = '0900'
          for (var j = 0; j < onlyFcstDate.length; j++) {
            if (fcstTime === onlyFcstDate[j].fcstTime) {
              onlyFcstTime.push(onlyFcstDate[j])
            }
          }

          var sky = 'SKY'
          var t3h = 'T3H'
          var reh = 'REH'
          for (var k = 0; k < onlyFcstTime.length; k++) {
            if (sky === onlyFcstTime[k].category) {
              switch (onlyFcstTime[k].fcstValue + '') {
                case '1' :
                  this.tomAmSkyImg = require('../assets/sun.png')
                  break
                case '2' :
                  this.tomAmSkyImg = require('../assets/cloud1.png')
                  break
                case '3' :
                  this.tomAmSkyImg = require('../assets/cloud2.png')
                  break
                case '4' :
                  this.tomAmSkyImg = require('../assets/heu.png')
                  break
                default :
                  break
              }
            } else if (t3h === onlyFcstTime[k].category) {
              this.tomorrowAmT1h = onlyFcstTime[k].fcstValue + '℃'
            } else if (reh === onlyFcstTime[k].category) {
              this.tt1Reh = onlyFcstTime[k].fcstValue + '%'
            }
          }

          onlyFcstTime = []
          fcstTime = '1200'
          for (j = 0; j < onlyFcstDate.length; j++) {
            if (fcstTime === onlyFcstDate[j].fcstTime + '') {
              onlyFcstTime.push(onlyFcstDate[j])
            }
          }

          for (k = 0; k < onlyFcstTime.length; k++) {
            if (sky === onlyFcstTime[k].category) {
              switch (onlyFcstTime[k].fcstValue + '') {
                case '1' :
                  this.tomPmSkyImg = require('../assets/sun.png')
                  break
                case '2' :
                  this.tomPmSkyImg = require('../assets/cloud1.png')
                  break
                case '3' :
                  this.tomPmSkyImg = require('../assets/cloud2.png')
                  break
                case '4' :
                  this.tomPmSkyImg = require('../assets/heu.png')
                  break
                default :
                  break
              }
            } else if (t3h === onlyFcstTime[k].category) {
              this.tomorrowPmT1h = onlyFcstTime[k].fcstValue + '℃'
            } else if (reh === onlyFcstTime[k].category) {
              this.tt1Reh = onlyFcstTime[k].fcstValue + '%'
            }
          }
          // TOMORROW END
          // AFTER TOMORROW START
          todayDate = new Date()
          todayDate.setDate(todayDate.getDate() + 2)
          todayYYYYMMDD = this.leadingZeros(todayDate.getFullYear(), 4) +
                              this.leadingZeros(todayDate.getMonth() + 1, 2) +
                              this.leadingZeros(todayDate.getDate(), 2) + ''
          this.tt2Date = todayYYYYMMDD.substring(4, 6) + '/' + todayYYYYMMDD.substring(6, 8)
          onlyFcstDate = []
          for (i = 0; i < response.data.item.length; i++) {
            if (todayYYYYMMDD === response.data.item[i].fcstDate + '') {
              onlyFcstDate.push(response.data.item[i])
            }
          }

          onlyFcstTime = []
          fcstTime = '0900'
          for (j = 0; j < onlyFcstDate.length; j++) {
            if (fcstTime === onlyFcstDate[j].fcstTime) {
              onlyFcstTime.push(onlyFcstDate[j])
            }
          }

          for (k = 0; k < onlyFcstTime.length; k++) {
            if (sky === onlyFcstTime[k].category) {
              switch (onlyFcstTime[k].fcstValue + '') {
                case '1' :
                  this.afTomAmSkyImg = require('../assets/sun.png')
                  break
                case '2' :
                  this.afTomAmSkyImg = require('../assets/cloud1.png')
                  break
                case '3' :
                  this.afTomAmSkyImg = require('../assets/cloud2.png')
                  break
                case '4' :
                  this.afTomAmSkyImg = require('../assets/heu.png')
                  break
                default :
                  break
              }
            } else if (t3h === onlyFcstTime[k].category) {
              this.afterTomorrowAmT1h = onlyFcstTime[k].fcstValue + '℃'
            } else if (reh === onlyFcstTime[k].category) {
              this.tt2Reh = onlyFcstTime[k].fcstValue + '%'
            }
          }

          onlyFcstTime = []
          fcstTime = '1200'
          for (j = 0; j < onlyFcstDate.length; j++) {
            if (fcstTime === onlyFcstDate[j].fcstTime + '') {
              onlyFcstTime.push(onlyFcstDate[j])
            }
          }

          for (k = 0; k < onlyFcstTime.length; k++) {
            if (sky === onlyFcstTime[k].category) {
              switch (onlyFcstTime[k].fcstValue + '') {
                case '1' :
                  this.afTomPmSkyImg = require('../assets/sun.png')
                  break
                case '2' :
                  this.afTomPmSkyImg = require('../assets/cloud1.png')
                  break
                case '3' :
                  this.afTomPmSkyImg = require('../assets/cloud2.png')
                  break
                case '4' :
                  this.afTomPmSkyImg = require('../assets/heu.png')
                  break
                default :
                  break
              }
            } else if (t3h === onlyFcstTime[k].category) {
              this.afterTomorrowPmT1h = onlyFcstTime[k].fcstValue + '℃'
            } else if (reh === onlyFcstTime[k].category) {
              this.tt2Reh = onlyFcstTime[k].fcstValue + '%'
            }
          }
          // AFTER TOMORROW END
        },
        async fetchAirData (tmX, tmY) {
          const response = await WeatherService.fetchAirData({
            tmX: tmX,
            tmY: tmY
          })
          // console.log(response.data.pm10Grade)
          switch (response.data.pm10Grade) {
            case '1' :
              this.todayPm10 = '미세먼지:좋음'
              break
            case '2' :
              this.todayPm10 = '미세먼지:보통'
              break
            case '3' :
              this.todayPm10 = '미세먼지:나쁨'
              break
            case '4' :
              this.todayPm10 = '미세먼지:매우나쁨'
              break
            default :
              break
          }
        },
        toogleDataSeries: function (e) {
          if (typeof (e.dataSeries.visible) === 'undefined' || e.dataSeries.visible) {
            e.dataSeries.visible = false
          } else {
            e.dataSeries.visible = true
          }
          this.chart6.render()
        },
        toogleDataSeries2: function (e) {
          if (typeof (e.dataSeries.visible) === 'undefined' || e.dataSeries.visible) {
            e.dataSeries.visible = false
          } else {
            e.dataSeries.visible = true
          }
          this.chart7.render()
        },
        leadingZeros: function (n, digits) {
          var zero = ''
          n = n.toString()

          if (n.length < digits) {
            for (var i = 0; i < digits - n.length; i++) {
              zero += '0'
            }
          }
          return zero + n
        },
        getLocation: function () {
          this.getWeatherData()
        },
        async getWeatherData () {
          var vm = this
          // Do geo coding
          // https://github.com/googlemaps/google-maps-services-js
          var googleMapsClient = require('@google/maps').createClient({
            key: 'AIzaSyAbcu_ORn9DV9mv0GFbxwX3FrYFMyL-nRA'
          })
          googleMapsClient.geocode({
            address: this.selectAddress
          }, function (err, response) {
            if (!err) {
              var convertedXY = vm.dfs_xy_conv('toXY', response.json.results[0].geometry.location.lat, response.json.results[0].geometry.location.lng)
              vm.fetchTodayWeather(convertedXY.x, convertedXY.y)
              vm.fetchWeatherForecast(convertedXY.x, convertedXY.y)

              // https://www.npmjs.com/package/proj4
              // http://www.gisdeveloper.co.kr/?p=1854
              var firstProjection = '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs'
              var secondProjection = '+proj=longlat +ellps=bessel +towgs84=-146.43,507.89,681.46 +no_defs'
              var tmXY = proj4(firstProjection, secondProjection, [convertedXY.y, convertedXY.x])
              vm.fetchAirData(tmXY[0], tmXY[1])
            }
          })
        },
        dfs_xy_conv: function (code, v1, v2) { // http://fronteer.kr/service/kmaxy - 37.579871128849334, 126.98935225645432 => 60, 127
          var RE = 6371.00877 // 지구 반경(km)
          var GRID = 5.0 // 격자 간격(km)
          var SLAT1 = 30.0 // 투영 위도1(degree)
          var SLAT2 = 60.0 // 투영 위도2(degree)
          var OLON = 126.0 // 기준점 경도(degree)
          var OLAT = 38.0 // 기준점 위도(degree)
          var XO = 43 // 기준점 X좌표(GRID)
          var YO = 136 // 기1준점 Y좌표(GRID)

          var DEGRAD = Math.PI / 180.0
          var RADDEG = 180.0 / Math.PI

          var re = RE / GRID
          var slat1 = SLAT1 * DEGRAD
          var slat2 = SLAT2 * DEGRAD
          var olon = OLON * DEGRAD
          var olat = OLAT * DEGRAD

          var sn = Math.tan(Math.PI * 0.25 + slat2 * 0.5) / Math.tan(Math.PI * 0.25 + slat1 * 0.5)
          sn = Math.log(Math.cos(slat1) / Math.cos(slat2)) / Math.log(sn)
          var sf = Math.tan(Math.PI * 0.25 + slat1 * 0.5)
          sf = Math.pow(sf, sn) * Math.cos(slat1) / sn
          var ro = Math.tan(Math.PI * 0.25 + olat * 0.5)
          ro = re * sf / Math.pow(ro, sn)
          var rs = {}
          if (code === 'toXY') {
            rs['lat'] = v1
            rs['lng'] = v2
            var ra = Math.tan(Math.PI * 0.25 + (v1) * DEGRAD * 0.5)
            ra = re * sf / Math.pow(ra, sn)
            var theta = v2 * DEGRAD - olon
            if (theta > Math.PI) theta -= 2.0 * Math.PI
            if (theta < -Math.PI) theta += 2.0 * Math.PI
            theta *= sn
            rs['x'] = Math.floor(ra * Math.sin(theta) + XO + 0.5)
            rs['y'] = Math.floor(ro - ra * Math.cos(theta) + YO + 0.5)
          } else {
            rs['x'] = v1
            rs['y'] = v2
            var xn = v1 - XO
            var yn = ro - v2 + YO
            ra = Math.sqrt(xn * xn + yn * yn)
            if (sn < 0.0) {
              ra = -ra
            }
            var alat = Math.pow((re * sf / ra), (1.0 / sn))
            alat = 2.0 * Math.atan(alat) - Math.PI * 0.5

            if (Math.abs(xn) <= 0.0) {
              theta = 0.0
            } else {
              if (Math.abs(yn) <= 0.0) {
                theta = Math.PI * 0.5
                if (xn < 0.0) {
                  theta = -theta
                }
              } else theta = Math.atan2(xn, yn)
            }
            var alon = theta / sn + olon
            rs['lat'] = alat * RADDEG
            rs['lng'] = alon * RADDEG
          }
          return rs
        },
        numberWithCommas: function (x) {
          return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
        },
        explodePie: function (e) {
          for (var i = 0; i < e.dataSeries.dataPoints.length; i++) {
            if (i !== e.dataPointIndex) {
              e.dataSeries.dataPoints[i].exploded = false
            }
          }
        }
  }
}
</script>